<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

    <!-- fontawesome -->
    <script src="https://kit.fontawesome.com/490ac8585b.js" crossorigin="anonymous"></script>


    <script>
        var stepToCSS = 'px'
        var stepToCalc = 100
        var leftPos = 0
        var topPos = 0
        var timeDelay = 200
        
        var isMoving
        var lastInput

        var actualDirection = null

        var ms = timeDelay/10
        var temp = null
        var timeInputs
        var timeBetweenInputs = 30
        var counter = 0
        var numberKeysDown = 0

        var lastPosTop = 0
        var lastPosLeft = 0

        document.onkeydown = function(asd){
            if ((lastInput != asd.key && asd.key == 'a' || asd.key == 'w' || asd.key == 's' || asd.key == 'd') && (counter > timeBetweenInputs || counter === 0)){

                moveSnake(asd.key)

                counter = 0
                if (numberKeysDown % 2 === 0){ //Contador para evitar dupla inserção de teclas
                    if (timeInputs === undefined){
                        timeInputs = setInterval(
                            function(){
                                counter++
                                document.getElementById('h1-nav').innerHTML = counter
                            },1
                        )
                    }
                }

                lastInput = asd.key
                numberKeysDown++
            }
        }
        function canMove(firstTarget, secondTarget, operation){
      
            lastPosLeft = leftPos
            lastPosTop = topPos

            if ( operation == '+'){
                if(firstTarget == 'leftPos'){
                    leftPos += stepToCalc
                }
                else{
                    topPos += stepToCalc
                }
            }
            else{
                if(firstTarget == 'leftPos'){
                    leftPos -= stepToCalc
                }
                else{
                    topPos -= stepToCalc
                }
            }

            if (temp === null){
                temp = setInterval(
                        function(){
                            ms--
                            //document.getElementById('snake').innerHTML = ms
                            if (ms == 0){
                                ms = timeDelay/10
                            }
                        },
                        10
                )
            }
            if (leaveMap()){
                clearAllInterval()
            }
            else{
                if(secondTarget === true){
                    snakePos.left = leftPos + stepToCSS
                }
                else{
                    snakePos.top = topPos + stepToCSS
                }
            }

        }

        var posString = ''
        var operationString = ''
        var isLeft = false
        function moveSnake(directionLocal){
            
            if (isMoving === undefined){
                isMoving = setInterval(
                        function(){
                            
                            canMove(posString, isLeft, operationString)
                            collision()
                            if (hasBody){bodySnake()}
                        },
                        timeDelay
                    )
            }

            whichDirection(directionLocal)
        }
        function whichDirection(direction){
            switch (direction){
                case 'a':{
                    if (actualDirection != 'd'){
                        posString = 'leftPos'
                        operationString = '-'
                        isLeft = true
                        actualDirection = 'a'
                    }
                    break
                }
                case 'w':{
                    if (actualDirection != 's'){
                        posString = 'topPos'
                        operationString = '-'
                        isLeft = false
                        actualDirection = 'w'
                    }
                    break
                }
                case 's':{
                    if (actualDirection != 'w'){
                        posString = 'topPos'
                        operationString = '+'
                        isLeft = false
                        actualDirection = 's'
                    }
                    break
                }
                case 'd':{
                    if (actualDirection != 'a'){
                        posString = 'leftPos'
                        operationString = '+'
                        isLeft = true
                        actualDirection = 'd'
                    }
                    break
                }
            }
        }
        function clearAllInterval(){
            clearInterval(isMoving)
            clearInterval(temp)
            clearInterval(timeInputs)
        }
        function leaveMap(){
            if (leftPos < 0 || leftPos >= 1400 || topPos < 0 || topPos >= 600){ 
                return true
            }    
        }
        function collision(){
            if (snakePosGet.top === foodPosGet.top && snakePosGet.left === foodPosGet.left){
                randomPosition()
                hasBody = true
                document.getElementById('snake').innerHTML += '<span class="snake-body"></span>'  
            }
            
        }
        function randomPosition(){
            var x = Math.ceil(Math.random() * (7)) * stepToCalc
            var y = Math.ceil(Math.random() * (3)) * stepToCalc

            foodPos.left = x + stepToCSS
            foodPos.top = y + stepToCSS
        }

        var bodyArray = new Array()
        const bodyGet = document.getElementsByClassName('snake-body')
        var hasBody = false
        function bodySnake(){

            bodyGet[0].style.left = (leftPos) + stepToCSS
            bodyGet[0].style.top = (topPos) + stepToCSS

            console.log('LEFT: ' + leftPos)
            console.log('TOP: ' + topPos)
        }
    </script>

    <style>
        .nav{
            width: 1400px;
            height: 150px;
            background-color: lightgray;
        }
        .map{
            width: 1400px;
            height: 600px;
            background-color: gray;
            position: relative;
        }
        #map{
            color: black;
            font-size: 5rem;
        }
        #snake{
            width: 100px;
            height: 100px;
            background-color: green;
            position: absolute;
        }
        .snake-body{
            width: 100px;
            height: 100px;
            background-color: rgb(38, 8, 189);
            position: absolute;
        }
        .food{
            width: 100px;
            height: 100px;
            position: absolute;
            background-color: red;
            left: 600px;
            top: 200px;
        }
    </style>
</head>
<body>

    
    <main class="d-flex justify-content-center flex-wrap">
        <div class="nav d-block">
            <h1 id="h1-nav"></h1>
            <h2 id="h2-nav"></h2>
        </div>
        <div class="map" id="map">
            <div id="snake"></div>
            
            <div class="food" id="food"></div>
        </div>
    </main>

    <script>
        var pressed = document.getElementById('pressed')
        const snakePos = document.getElementById('snake').style
        const foodPos = document.getElementById('food').style
        const snakePosGet = window.getComputedStyle(document.getElementById('snake'))
        const foodPosGet = window.getComputedStyle(document.getElementById('food'))
        
    </script>
</body>
</html>